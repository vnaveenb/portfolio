services:
  portfolio:
    # Use the image built by GitHub Actions
    image: ghcr.io/vnaveenb/portfolio:latest
    container_name: portfolio
    restart: unless-stopped
    ports:
      - "3529:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  # Watchtower automatically updates the portfolio when a new image is pushed
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=300 # Check every 300 seconds (5 minutes)
    command: --interval 300

  # Uncomment below after setting up cloudflared tunnel
  # cloudflared:
  #   image: cloudflare/cloudflared:latest
  #   container_name: cloudflared
  #   restart: unless-stopped
  #   command: tunnel run
  #   environment:
  #     - TUNNEL_TOKEN=your_tunnel_token_here
  #   depends_on:
  #     - portfolio
